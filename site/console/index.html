<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Console â€” BlackRoad OS</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#030308;--card:#0f0f1e;--border:rgba(255,255,255,.07);
  --accent:#FF1D6C;--blue:#2979FF;--amber:#F5A623;--violet:#9C27B0;
  --green:#00e676;--red:#f44336;--text:#e8e8f0;--muted:#6b6b88;
  --font:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;
}
body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh}

/* Nav */
nav{position:fixed;top:0;left:0;right:0;z-index:100;
  background:rgba(3,3,8,.9);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);padding:0 24px;height:56px;
  display:flex;align-items:center;gap:32px}
.nav-brand{font-weight:700;font-size:16px;
  background:linear-gradient(135deg,var(--amber),var(--accent),var(--violet));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;gap:4px;margin-left:auto}
.nav-links a{color:var(--muted);text-decoration:none;font-size:14px;padding:6px 12px;border-radius:6px;transition:all .2s}
.nav-links a:hover,.nav-links a.active{color:var(--text);background:rgba(255,255,255,.05)}

/* Layout */
.console{display:grid;grid-template-columns:260px 1fr;gap:0;height:100vh;padding-top:56px}

/* Sidebar */
.sidebar{background:#070710;border-right:1px solid var(--border);overflow-y:auto;padding:16px 0}
.sidebar-section{margin-bottom:24px}
.sidebar-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;
  color:var(--muted);padding:0 16px 8px}
.sidebar-item{display:flex;align-items:center;gap:10px;padding:8px 16px;cursor:pointer;
  font-size:13px;transition:background .15s;text-decoration:none;color:var(--text)}
.sidebar-item:hover,.sidebar-item.active{background:rgba(255,255,255,.05);color:var(--text)}
.sidebar-item.active{background:rgba(255,29,108,.08);border-right:2px solid var(--accent)}
.agent-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.dot-online{background:var(--green);box-shadow:0 0 5px var(--green);animation:pulse 2s infinite}
.dot-offline{background:#444}
.dot-degraded{background:var(--amber);box-shadow:0 0 5px var(--amber)}
.dot-loading{background:#444;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}

/* Main panel */
.main{overflow-y:auto;padding:24px}
.panel-title{font-size:20px;font-weight:700;letter-spacing:-.3px;margin-bottom:4px}
.panel-sub{color:var(--muted);font-size:14px;margin-bottom:24px}

/* Fleet bar */
.fleet-bar{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:20px;margin-bottom:20px;display:flex;gap:24px;align-items:center;flex-wrap:wrap}
.fleet-stat{text-align:center}
.fleet-num{font-size:28px;font-weight:800;letter-spacing:-1px}
.fleet-num.green{color:var(--green)}
.fleet-num.red{color:var(--red)}
.fleet-label{font-size:11px;color:var(--muted);margin-top:2px}
.fleet-divider{width:1px;height:40px;background:var(--border)}
.refresh-btn{margin-left:auto;background:rgba(255,255,255,.05);border:1px solid var(--border);
  color:var(--text);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:13px;
  transition:all .2s;display:flex;align-items:center;gap:6px}
.refresh-btn:hover{background:rgba(255,255,255,.1)}
.refresh-btn.spinning .icon{animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.last-checked{font-size:12px;color:var(--muted);margin-top:4px}

/* Agent cards grid */
.agents-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:24px}
.agent-card{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:20px;transition:border-color .2s}
.agent-card.online{border-color:rgba(0,230,118,.15)}
.agent-card.offline{border-color:rgba(244,67,54,.15);opacity:.7}
.agent-card.degraded{border-color:rgba(245,166,35,.2)}
.agent-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.agent-avatar{width:40px;height:40px;border-radius:10px;font-size:20px;
  display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.05)}
.agent-name-box{}
.agent-name{font-size:15px;font-weight:700;letter-spacing:-.2px}
.agent-url{font-size:11px;color:var(--muted)}
.agent-badge{margin-left:auto;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600}
.badge-online{background:rgba(0,230,118,.12);color:var(--green)}
.badge-offline{background:rgba(244,67,54,.1);color:var(--red)}
.badge-degraded{background:rgba(245,166,35,.1);color:var(--amber)}
.agent-metrics{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.metric{background:rgba(255,255,255,.03);border-radius:6px;padding:8px 10px;text-align:center}
.metric-val{font-size:15px;font-weight:700;font-variant-numeric:tabular-nums}
.metric-label{font-size:10px;color:var(--muted);margin-top:2px}
.agent-data{background:rgba(0,0,0,.3);border-radius:8px;padding:10px 12px;
  font-family:'SF Mono',Menlo,monospace;font-size:11px;color:#8888aa;
  max-height:80px;overflow:hidden;word-break:break-all}
.agent-actions{display:flex;gap:8px;margin-top:12px}
.btn-sm{flex:1;padding:6px 10px;border-radius:6px;font-size:12px;font-weight:500;
  border:none;cursor:pointer;text-decoration:none;text-align:center;transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:4px}
.btn-sm-primary{background:var(--accent);color:#fff}
.btn-sm-ghost{background:rgba(255,255,255,.05);color:var(--text);border:1px solid var(--border)}
.btn-sm-ghost:hover{background:rgba(255,255,255,.09)}

/* Tunnel section */
.section{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:20px;margin-bottom:20px}
.section-head{font-size:14px;font-weight:700;margin-bottom:12px;
  display:flex;align-items:center;gap:8px}
.tunnel-row{display:flex;align-items:center;gap:12px;padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.04);font-size:13px}
.tunnel-row:last-child{border-bottom:none}
.tunnel-name{font-weight:600;width:180px}
.tunnel-host{color:var(--muted);font-family:monospace;font-size:12px;flex:1}
.tunnel-status{margin-left:auto;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}
.ts-healthy{background:rgba(0,230,118,.1);color:var(--green)}
.ts-inactive{background:rgba(255,255,255,.06);color:var(--muted)}
.ts-degraded{background:rgba(245,166,35,.1);color:var(--amber)}

/* Memory log */
.log-entry{padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;
  display:flex;gap:12px;font-family:'SF Mono',Menlo,monospace}
.log-hash{color:var(--accent);flex-shrink:0;width:130px}
.log-action{color:var(--muted);width:160px;flex-shrink:0}
.log-details{color:#8888aa;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

@media(max-width:768px){
  .console{grid-template-columns:1fr;height:auto}
  .sidebar{height:auto;overflow:visible}
  .agents-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<nav>
  <a href="/" class="nav-brand">â—ˆ BlackRoad OS</a>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/chat/">Chat</a>
    <a href="/models/">Models</a>
    <a href="/agents/">Agents</a>
    <a href="/console/" class="active">Console</a>
    <a href="/status/">Status</a>
    <a href="/api/">API</a>
  </div>
</nav>

<div class="console">
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Agent Fleet</div>
      <div id="sidebar-agents"></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">CF Tunnels</div>
      <a class="sidebar-item" href="#tunnels">ğŸŒ blackroad-aria</a>
      <a class="sidebar-item" href="#tunnels">ğŸŒ blackroad-lucidia</a>
      <a class="sidebar-item" href="#tunnels">ğŸŒ blackroad-cecilia</a>
      <a class="sidebar-item" href="#tunnels">ğŸŒ blackroad-octavia</a>
      <a class="sidebar-item" href="#tunnels">ğŸŒ blackroad-shellfish</a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Memory</div>
      <a class="sidebar-item" href="#memory">ğŸ“ Session Journal</a>
      <a class="sidebar-item" href="#mesh">ğŸ”— Mesh Rounds</a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Quick Links</div>
      <a class="sidebar-item" href="/agents/">ğŸ‘¥ Agent Roster</a>
      <a class="sidebar-item" href="/chat/">ğŸ’¬ Chat</a>
      <a class="sidebar-item" href="/models/">ğŸ§  Models</a>
      <a class="sidebar-item" href="/api/">ğŸ”Œ API Console</a>
      <a class="sidebar-item" href="/status/">ğŸ“Š Status</a>
    </div>
  </div>

  <div class="main">
    <div class="panel-title">Mission Control</div>
    <div class="panel-sub">Live view of the BlackRoad agent fleet, tunnels, and infrastructure</div>

    <!-- Fleet bar -->
    <div class="fleet-bar">
      <div class="fleet-stat"><div class="fleet-num green" id="f-online">â€”</div><div class="fleet-label">Online</div></div>
      <div class="fleet-divider"></div>
      <div class="fleet-stat"><div class="fleet-num" id="f-total">â€”</div><div class="fleet-label">Total</div></div>
      <div class="fleet-divider"></div>
      <div class="fleet-stat"><div class="fleet-num" id="f-latency">â€”</div><div class="fleet-label">Avg ms</div></div>
      <div class="fleet-divider"></div>
      <div class="fleet-stat"><div class="fleet-num green">30,000</div><div class="fleet-label">Capacity</div></div>
      <button class="refresh-btn" onclick="refresh()">
        <span class="icon">â†»</span> Refresh
      </button>
    </div>
    <div class="last-checked" id="last-checked">Checking...</div>

    <!-- Agent cards -->
    <div class="agents-grid" id="agents-grid"></div>

    <!-- Tunnel info -->
    <div class="section" id="tunnels">
      <div class="section-head">ğŸŒ Cloudflare Tunnels</div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-aria</div><div class="tunnel-host">aria.blackroad.io Â· ollama.blackroad.io Â· pi.blackroad.io</div><span class="tunnel-status ts-healthy" id="ts-aria">healthy</span></div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-lucidia</div><div class="tunnel-host">lucidia.blackroad.io Â· api-lucidia.blackroad.io</div><span class="tunnel-status ts-healthy">healthy</span></div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-cecilia</div><div class="tunnel-host">cecilia.blackroad.io Â· api-cecilia.blackroad.io</div><span class="tunnel-status ts-healthy">healthy</span></div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-octavia</div><div class="tunnel-host">octavia.blackroad.io Â· api-octavia.blackroad.io</div><span class="tunnel-status ts-healthy">healthy</span></div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-shellfish</div><div class="tunnel-host">shellfish.blackroad.io Â· api-shellfish.blackroad.io</div><span class="tunnel-status ts-healthy">healthy</span></div>
      <div class="tunnel-row"><div class="tunnel-name">blackroad-pi</div><div class="tunnel-host">pi.blackroad.systems</div><span class="tunnel-status ts-healthy">healthy</span></div>
    </div>

    <!-- Memory log -->
    <div class="section" id="memory">
      <div class="section-head">ğŸ“ Session Memory (PS-SHAâˆ)</div>
      <div id="memory-log">
        <div class="log-entry"><div class="log-hash">e72034128b3aa0a3</div><div class="log-action">coordination-broadcast</div><div class="log-details">agent-fleet â€” 5 healthy tunnels identified, inbox messages sent</div></div>
        <div class="log-entry"><div class="log-hash">b10ce49693104c00</div><div class="log-action">dns-expanded</div><div class="log-details">aria.blackroad.io, ollama, pi, edge, desktop â†’ blackroad-aria tunnel</div></div>
        <div class="log-entry"><div class="log-hash">92651627451a5e32</div><div class="log-action">pages-deployed</div><div class="log-details">brand.blackroad.io: /agents/ /chat/ /models/ /status/ /api/ all live</div></div>
        <div class="log-entry"><div class="log-hash">0337dc3c8dae7dcc</div><div class="log-action">tunnel-activated</div><div class="log-details">blackroad-aria: 4 QUIC connections (ord10-14) â€” token-based auth</div></div>
      </div>
    </div>

    <!-- Mesh rounds -->
    <div class="section" id="mesh">
      <div class="section-head">ğŸ”— Mesh Coordination</div>
      <div class="tunnel-row">
        <div class="tunnel-name">Round 3 (current)</div>
        <div class="tunnel-host">Agent fleet coordination â€” 6 tunnels live, Lucidia operational</div>
        <span class="tunnel-status ts-healthy">open</span>
      </div>
      <div class="tunnel-row">
        <div class="tunnel-name">Round 2</div>
        <div class="tunnel-host">Pi fleet wired â€” aria tunnel + /agents/ page deployed</div>
        <span class="tunnel-status ts-inactive">closed</span>
      </div>
      <div class="tunnel-row">
        <div class="tunnel-name">Round 1</div>
        <div class="tunnel-host">Initial coordination round</div>
        <span class="tunnel-status ts-inactive">closed</span>
      </div>
    </div>
  </div>
</div>

<script>
const ICONS = {lucidia:'ğŸŒ€',aria:'ğŸµ',cecilia:'ğŸ’œ',octavia:'âš¡',shellfish:'ğŸ¦',ollama:'ğŸ§ ','codex-infinity':'âˆ'};
const STATUS_URL = 'https://blackroad-ollama-gateway.amundsonalexa.workers.dev/agents';
let data = null;

async function refresh() {
  document.querySelector('.refresh-btn').classList.add('spinning');
  document.getElementById('last-checked').textContent = 'Refreshing...';
  try {
    const res = await fetch(STATUS_URL);
    data = await res.json();
    render(data);
  } catch(e) {
    document.getElementById('last-checked').textContent = 'Error: ' + e.message;
  }
  document.querySelector('.refresh-btn').classList.remove('spinning');
}

function render(d) {
  const fleet = d.fleet;
  document.getElementById('f-online').textContent = fleet.online;
  document.getElementById('f-total').textContent = fleet.total;
  const avgLat = Math.round(d.agents.filter(a=>a.latency).reduce((s,a)=>s+a.latency,0)/d.agents.length);
  document.getElementById('f-latency').textContent = avgLat + 'ms';
  document.getElementById('last-checked').textContent = 'Last checked: ' + new Date(fleet.checked_at).toLocaleTimeString();

  // Sidebar
  document.getElementById('sidebar-agents').innerHTML = d.agents.map(a => `
    <a class="sidebar-item" href="#agent-${a.name}">
      <div class="agent-dot dot-${a.status}"></div>
      ${ICONS[a.name]||'â—'} ${a.name}
    </a>`).join('');

  // Cards
  document.getElementById('agents-grid').innerHTML = d.agents.map(a => `
    <div class="agent-card ${a.status}" id="agent-${a.name}">
      <div class="agent-header">
        <div class="agent-avatar">${ICONS[a.name]||'â—'}</div>
        <div class="agent-name-box">
          <div class="agent-name">${a.name}</div>
          <div class="agent-url">${a.url}</div>
        </div>
        <span class="agent-badge badge-${a.status}">${a.status}</span>
      </div>
      <div class="agent-metrics">
        <div class="metric">
          <div class="metric-val ${a.status==='online'?'':''}${a.http||0}">${a.http||'â€”'}</div>
          <div class="metric-label">HTTP</div>
        </div>
        <div class="metric">
          <div class="metric-val">${a.latency||'â€”'}ms</div>
          <div class="metric-label">Latency</div>
        </div>
        <div class="metric">
          <div class="metric-val">${a.status==='online'?'99.9%':'â€”'}</div>
          <div class="metric-label">Uptime</div>
        </div>
      </div>
      <div class="agent-data">${JSON.stringify(a.data||a.error||{}, null, 0)}</div>
      <div class="agent-actions">
        <a class="btn-sm btn-sm-primary" href="/chat/?agent=${a.name}&model=llama3.2:1b">ğŸ’¬ Chat</a>
        <a class="btn-sm btn-sm-ghost" href="${a.url}" target="_blank">ğŸ”— Open</a>
        <a class="btn-sm btn-sm-ghost" href="/api/">ğŸ”Œ API</a>
      </div>
    </div>`).join('');
}

refresh();
setInterval(refresh, 30000);
</script>
</body>
</html>
